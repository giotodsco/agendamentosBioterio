<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/acexx/front-end/Estilos/style_agendar.css">
    <title>Biotério - Agendar</title>
</head>
<style>
    body {
        overflow: hidden;
    }
    #div_geral_color {
    background: radial-gradient(circle, rgba(173,199,205,1) 0%, rgba(169,189,165,1) 31%, rgba(64, 122, 53, 0.819) 85%);
    height: 100vh;
}
#div_geral_centro {
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
}
#div_info_agendar {
    width: 60%;
    background-color: rgb(225, 225, 228);
    height:95%;
    border-radius: 20px;
    box-shadow: 5px 5px 50px rgba(90, 90, 90, 0.392);
}
#btns {
    display: flex;
    justify-content: space-evenly;
}
#titulo_principal {
    text-align: center;
    font-size: 30px;
    padding-top: 30px;
    padding-bottom: 20px;
    color: rgb(75, 74, 74);
}
.voltar_inicio {
    padding-top: 25px;
    text-align: center;
}
.voltar_inicio a {
    text-decoration: none;
    color: rgb(55, 75, 51);
    font-weight: 600;
}
.txt_agendar {
    margin-left: 20%;
    padding-top: 15px;
    padding-bottom: 5px;
    font-size: 18px;
    color: rgb(81, 81, 81);
}
#nome_input, #email_input, #data_input, #hora_input {
    width: 60%;
    height: 35px;
    border: none;
    border-radius: 10px;
    margin-left: 20%;
    padding-left: 10px;
    box-sizing: border-box; /* Garante que o padding não aumente a largura total */
}
#e_aluno_input {
    margin-left: 20%;
    margin-top: 10px;
    width: 20px; /* Ajuste o tamanho do checkbox conforme necessário */
    height: 20px;
}
#btn_agendar {
    width: 200px;
    height: 40px;
    border: none;
    border-radius: 20px;
    background-color: rgb(55, 75, 51);
    color: white;
    font-weight: bold;
    cursor: pointer;
    margin-left: 50%; /* Centraliza o botão */
    transform: translateX(-50%); /* Ajuste fino para centralização */
    margin-top: 20px;
}
</style>
<body>
    <div id="div_geral_color">
        <div id="div_geral_centro">
            <div id="div_info_agendar">
                <p id="titulo_principal">Agende seu horário!</p>

                <form action="/acexx/back-end/agendar.php" method="POST">
                    <p class="txt_agendar">Seu Nome Completo:</p>
                    <input type="text" name="nome" id="nome_input" placeholder="Ex: João da Silva" required>

                    <p class="txt_agendar">Email:</p>
                    <input type="email" name="email" id="email_input" placeholder="seu.email@example.com" required>

                    <p class="txt_agendar">Você é aluno da FSA?</p>
                    <input type="checkbox" name="e_aluno" id="e_aluno_input" value="sim"> <label for="e_aluno_input">Sim</label>

                    <p class="txt_agendar">Data do Agendamento:</p>
                    <input type="date" name="data_agendamento" id="data_input" required>

                    <p class="txt_agendar">Hora do Agendamento:</p>
                    <input type="time" name="hora_agendamento" id="hora_input" min="08:00" max="17:00" required>

                    <button type="submit" id="btn_agendar">Agendar</button>
                </form>

                <div class="voltar_inicio">
                    <a href="pag_inicial.html">Voltar para a Página Inicial</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('data_input');
            const timeInput = document.getElementById('hora_input');

            // Definir data mínima como hoje
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            const minDate = `${year}-${month}-${day}`;
            dateInput.setAttribute('min', minDate);

            // Definir horários padrão de funcionamento
            const defaultMinTime = "08:00";
            const defaultMaxTime = "17:00";

            // Atualiza o min do input de tempo baseado na data selecionada
            dateInput.addEventListener('change', function() {
                const selectedDate = this.value;
                const currentDate = new Date().toISOString().slice(0, 10); // 'YYYY-MM-DD'

                if (selectedDate === currentDate) {
                    // Se a data selecionada for hoje, ajusta o min-time para a hora atual + 30 minutos
                    const now = new Date();
                    now.setMinutes(now.getMinutes() + 30); // Adiciona 30 minutos

                    let currentHour = now.getHours();
                    let currentMinute = now.getMinutes();

                    // Arredonda para o próximo incremento de 30 minutos, se necessário
                    if (currentMinute > 0 && currentMinute <= 30) {
                        currentMinute = 30;
                    } else if (currentMinute > 30) {
                        currentMinute = 0;
                        currentHour++;
                    }

                    // Formata a hora para HH:MM
                    const newMinTime = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;

                    // Ensures the min time for today does not exceed the max allowed time
                    if (newMinTime > defaultMaxTime) {
                        timeInput.setAttribute('min', defaultMaxTime); // If current time is after max, set min to max to prevent selection
                    } else {
                        timeInput.setAttribute('min', newMinTime);
                    }

                    // Also, reset the value if the current value is now invalid
                    if (timeInput.value && timeInput.value < newMinTime) {
                        timeInput.value = ''; // Clear the invalid time
                    }

                } else {
                    // Se não é hoje, reseta para o mínimo padrão e limpa a hora se ela for menor que o padrão
                    timeInput.setAttribute('min', defaultMinTime);
                    if (timeInput.value && timeInput.value < defaultMinTime) {
                        timeInput.value = '';
                    }
                }
                // Always reset max to default max, as it only depends on working hours, not current time
                timeInput.setAttribute('max', defaultMaxTime);
            });

            // Adiciona um listener para a mensagem de status (se houver)
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status');
            const mensagem = urlParams.get('mensagem');

            if (status && mensagem) {
                alert(decodeURIComponent(mensagem));
                // Opcional: remover os parâmetros da URL após exibir a mensagem
                history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>